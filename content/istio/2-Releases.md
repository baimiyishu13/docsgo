+++
title = '第2章：Istio 入门'
date = 2024-05-14T14:04:40+08:00
draft = true

+++

直接进入尽快使用 Istio，但是此篇并不打算太过深入

环境：MAC、Arm64、minikube



Istio 实际上是一个不同工具的集合 - 框架，包装在一起，所以在 Istio 中有相当多的组件

## woat is Istio？

Istio 被称为服务网格，在曾经很多面试官都喜欢问我 什么是 Istio ？？？

可以说 Istio 是一个服务网格 “Service Mesh”，那么意味着需要知道服务网格的概念是什么

当正在使用基于集群的微服务，会发现作为一个现有的框架，比如 kubernets，就其本身而言并不是相当完美，服务网格也不会取代 kubernetes，它实际上是一个额外的 软件层，和 Kubernetes 一起部署，服务网格不仅仅与 Kubernets 无关，任何一种分布式体系中这就是多个软件组件网格的地方。彼此直接，将从服务网格中受益。所以至今为止，Kubenrets 都被称为：编排框架。



🤔 一个标准的微服务体系结构在 Kubenrets 中运行

我们会有：

+ 一大堆的 Pod，每个Pod包含 一个或多个 Container。但是它是相当标准的，只有一个 Container
+ 使用了服务发现机制，在Kubernets 内部从任何容器进行网络调用。

k8s非常删除去管理Pod，如果需要删除一个Pod，向apiserver发生命令、kubectl、修改yaml等等。

但是，Kubernets 不擅长管理或在任何情况下管理Pod之间网络，很难推断出里面发生了什么，例如互联网络通信里面有一个错误，网络请求有一些是错误的。虽然可以对软件进行粗略的研究或者分析日志然后推断出出了什么事。

+ 如果知道是哪个容器出了问题还好，但是如果有数千个微服务，这些网络协调的组合非常复杂。只是标准的 Kubenrets，没有任何互联的不可见性或控制权。

🎯  这就是 服务网格可以提供帮助的地方

形容词：Service Mesh 【服务网格】

Istio 如何实施，从概念上以某种方式将通过集群中运行的网络流量将通过本服务网格软件进行路由。

例子：Pod 至今建立访问，通过 SVC 直接访问

但是有了 Service Mesh，将设置使所有访问都通过 Service Mesh 进行定向。

容器实际上不会钓鱼目标容器，它的网络请求是到 Service Mesh，然后Service Mesh 将负责记录指向目标。

+ 可以在调用被路由到目前之前实现逻辑
+ 目标返回结果也许是 http 200 回到 Service Mesh。

Telemetry：从网格中查找，用于收集指标。【可能我们已经习惯使用 prometheus和 Grafana这样的东西】都是一回事，这里收集的是网格请求，

+ 例如，每当收到请求时，Service Mesh会记录一次收到了请求，然后根据请求向目标Pod，当有返回结果时，Service Mesh逻辑可以计算该请求所用的时间并记录响应代码，不管是成功还是错误的，都会放入到某个数据库。意味着随着时间的推移，可以检查找到一个特定的服务，例如返回太多的错误。

![image-20240514152016548](/images/image-20240514152016548.png "Title")

另一个特定：追随

各种网格调用在一起实现一个单个用例，可以让网格告诉我们到底发生了什么，链中每一步需要多长时间，以及到底在那个链条上发生了什么，这是一个非常很难做的事

所有的访问都需要经过 Service Mech，所以这些就是服务网格的工作原理。

Istio 如何实现服务网格，技巧是 Istio 完成的集群中的每一个Pod，一般来说Pod中只有一个 Container，Istio 将在Pod中添加自己的容器

![image-20240514152751498](/images/image-20240514152751498.png "Title")

容器会认为它正在进行调研，但是实际上它只是调用执行代理。

+ 代理负责定向，对目标的代理调用，可能会有一些网络逻辑。

 ![image-20240514155800456](/images/image-20240514155800456.png "Title")

原始Pod就像是在 服务网格的下面，所有的网络请求都经过 Service Mesh【如-图1】

