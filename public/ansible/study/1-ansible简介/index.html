
<script src="/docsgo/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=docsgo/livereload" data-no-instant defer></script><div class="footer-content ">
    <div class="row" style="display: flex; justify-content: center; align-items: center;">

        <div class="col-md-4 col-md-offset-0 vcenter">
            <div style="text-align: center;">
                <img class="float-right" src="http://localhost:1313/docsgo/punching.gif" style="width: 40%">
                <br>
                <br>
            </div>
        </div>
        <div class="col-md-6 col-md-offset-1 vcenter">
            <div class="quote" style="font-size: 1.5em; font-family: 'Courier New', Courier, monospace; color: #888; margin-left: 20px; margin-right: 20px; text-align: center;">“成功绝非偶然。 这是努力工作、坚持不懈、学习、学习、牺牲，最重要的是，热爱你正在做的事情或正在学习的事情。” - 贝利</div>
        </div>
        <div class="col-md-4 col-md-offset-0 vcenter">
            <div style="text-align: center;">
                <img src="http://localhost:1313/docsgo/success.gif" style="width: 40%">
                <br>
                <br>
            </div>
        </div>
    </div>
</div>
<div id="article" style="padding-left: 20px; padding-right: 20px;">
    <div class="article-title">
        <h1>Ansible 简介</h1>
    </div>
    
    
    <time datetime="2024-04-08T15:56:38&#43;08:00">April 8, 2024</time>
    <hr/>
    <aside>
        <p> 目录: </p>
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ansible-简述">Ansible 简述</a></li>
        <li><a href="#安装-ansible">安装 Ansible</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </aside>
    <hr>
    <div class="post">
        <div id="content-font">
            <h3 id="ansible-简述">Ansible 简述</h3>
<p>此前，很多的shell 脚本的编写，没有任何真正容易简单的事情。并不像是编写Shell脚本 并在服务器上运行那么简单，尤其是必须在服务器上安装东西。</p>
<p>Ansible的出现使事情变得更加简单：</p>
<ul>
<li>不必了解某些特定的编程语言</li>
<li>基本上可以将 Shell 脚本简单的转换成 Ansible 脚本 - “剧本”，甚至无需使用特殊的 ansible 模块 或逻辑，非常轻松的运行所有服务器。</li>
</ul>
<p>作为初级到中级的Linux 管理员，需要掌握大规模基础设施的自动化。</p>
<p>Devops for Ansible</p>
<ul>
<li>Devops 对我来说 更多的是一种哲学，而不一定是一个职位或者角色。这种理念是开发和运维紧密联系。</li>
<li>当开发人员接管管道，从某种意义上来说，能够将开发和运维混合在一起。</li>
<li>仍然是需要 SRE 或 系统管理员来运行服务器并确保应用程序的正常运行，并且还有专门构建应用程序的开发人员。</li>
</ul>
<p>从Ansible 历史</p>
<ul>
<li>最初：允许在多台服务器上运行命令。</li>
<li>目标：清晰、完整、快速、高效和安全。</li>
</ul>
<p>Ansible 通过SSH与机器服务器交互，无需安装代理-守护进程或者在服务器上为自动化工具提供端口。</p>
<p>安全：使用安全传输协议</p>
<p>很多时候自动化的动机时：希望能够设置服务器，或者构建容器。</p>
<p>喜欢ansible 原因之一：可以将 shell脚本，shell 命令以及其他的任务转移到Ansible中，让Ansible去做它们。</p>
<h3 id="安装-ansible">安装 Ansible</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>pip3 install ansible
</span></span></code></pre></div><p>版本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ansible@ubuntu-c:~$ ansible --version
</span></span><span style="display:flex;"><span>ansible <span style="color:#f92672">[</span>core 2.14.11<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  config file <span style="color:#f92672">=</span> None
</span></span><span style="display:flex;"><span>  configured module search path <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;/home/ansible/.ansible/plugins/modules&#39;</span>, <span style="color:#e6db74">&#39;/usr/share/ansible/plugins/modules&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  ansible python module location <span style="color:#f92672">=</span> /usr/local/lib/python3.10/dist-packages/ansible
</span></span><span style="display:flex;"><span>  ansible collection location <span style="color:#f92672">=</span> /home/ansible/.ansible/collections:/usr/share/ansible/collections
</span></span><span style="display:flex;"><span>  executable location <span style="color:#f92672">=</span> /usr/local/bin/ansible
</span></span><span style="display:flex;"><span>  python version <span style="color:#f92672">=</span> 3.10.12 <span style="color:#f92672">(</span>main, Jun <span style="color:#ae81ff">11</span> 2023, 05:26:28<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>GCC 11.4.0<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>/usr/bin/python3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  jinja version <span style="color:#f92672">=</span> 3.1.2
</span></span><span style="display:flex;"><span>  libyaml <span style="color:#f92672">=</span> True
</span></span></code></pre></div><p>实验环境：</p>
<p>root 免密登陆：</p>
<p><img
    src="../../../static/images//image-20240408165308661.png" alt="image-20240408165308661"
    
    
    />
</p>
<p>也可以基于密码认证</p>
<p>创建：inventroy 文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>example<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ubuntu<span style="color:#f92672">[</span>1:3<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>centos<span style="color:#f92672">[</span>1:3
</span></span></code></pre></div><p>测试：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ansible -i inventroy example -m ping
</span></span></code></pre></div><p>创建 ansible.cfg , 将覆盖默认配置</p>
<p>模版命令：$ ansible-config init &ndash;disabled &gt; ansible.cfg</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>defaults<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>INVENTORY <span style="color:#f92672">=</span> inventory
</span></span></code></pre></div><p>构建虚拟机或者Docker 在其中实现自动化，完成后删除所有内容</p>
<p>第一个Playbook</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up NTP no all servers.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">all</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Ensure NTP is Install</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">yum</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">chrony</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#ae81ff">present</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">shell</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        if ! rpm -qa | grep -qw chrony; then
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          yum install -y chrony
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        fi</span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Ensure NTP is Running</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">systemd</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#ae81ff">started</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">chronyd</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">yes</span>
</span></span></code></pre></div><p>甚至可以删除注释, 最好添加 name，确切的知道任务具体内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">all</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">yum</span>: <span style="color:#ae81ff">name=chrony state=present</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">systemd</span>: <span style="color:#ae81ff">state=started name=chronyd enabled=yes</span>
</span></span></code></pre></div><p>幂等性：command 和 yum 同时存在安装同一软件，运行第二个时会提示已经更改</p>
<p>在学习 Ansible 之前，我实际上一直实验shell 脚本，有很多的 Shell 脚本，我喜欢能够在服务器上多次运行，但是维护起来非常困难。</p>
<p>Ansible 将这些抽象出来，语句更容易使用</p>

        </div>
    </div>
</div>
